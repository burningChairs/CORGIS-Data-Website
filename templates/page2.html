{% extends "layout.html" %}
{% block content %}
<h2>Missions</h2>

<div class="controls">
    <label>Filter by astronaut:
        <select id="astronautFilter">
            <option value="">All</option>
            {% for n in astronauts_names %}
            <option value="{{ n }}">{{ n }}</option>
            {% endfor %}
        </select>
    </label>

    <label>
        <select id="sortBy">
            <option value="year_desc">Year ↓</option>
            <option value="year_asc">Year ↑</option>
            <option value="name_asc">Mission ↑</option>
        </select>
    </label>
</div>

<table class="table">
    <thead>
        <tr>
            <th>Astronaut</th>
            <th>Mission</th>
            <th>Year</th>
            <th>Role</th>
            <th>Duration (days)</th>
        </tr>
    </thead>
    <tbody id="missionTbody">
        {% for m in missions %}
        <tr data-astronaut="{{ m.astronaut }}" data-year="{{ m.year }}" data-name="{{ m.name }}">
            <td>{{ m.astronaut }}</td>
            <td>{{ m.name }}</td>
            <td>{{ m.year }}</td>
            <td>{{ m.role }}</td>
            <td>{{ m.duration }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<script>
const filterSelect = document.getElementById('astronautFilter');
const sortSelect = document.getElementById('sortBy');
const tbody = document.getElementById('missionTbody');

// store rows
const allRows = Array.from(tbody.querySelectorAll('tr'));

function applyMissionControls() {
    const astronaut = filterSelect.value.trim().toLowerCase();
    const sort = sortSelect.value;
    
    let filteredRows = allRows.filter(r => !astronaut || r.dataset.astronaut.trim().toLowerCase() === astronaut);
    
    filteredRows.sort((a,b) => {
        if (sort === 'year_desc') return parseInt(b.dataset.year) - parseInt(a.dataset.year);
        if (sort === 'year_asc') return parseInt(a.dataset.year) - parseInt(b.dataset.year);
        if (sort === 'name_asc') return a.dataset.name.localeCompare(b.dataset.name);
        return 0;
    });

    // clear table and remake it depending on selected
    tbody.innerHTML = '';
    filteredRows.forEach(r => tbody.appendChild(r));
}

filterSelect.addEventListener('change', applyMissionControls);
sortSelect.addEventListener('change', applyMissionControls);

applyMissionControls();
</script>
{% endblock %}
